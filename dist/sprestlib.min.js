/* SpRestLib 1.9.0-beta-20181202 */
!function(){var i={0:"List",1:"Library",3:"Discussion Board",4:"Survey",5:"Issue"},u={0:"None",1:"User",2:"Distribution List",4:"Security Group",8:"SharePoint Group",15:"All"},c={baseUrl:"..",busySpinnerHtml:'<div class="sprlib-spinner"><div class="sprlib-bounce1"></div><div class="sprlib-bounce2"></div><div class="sprlib-bounce3"></div></div>',cache:!1,cleanColHtml:!0,currencyChar:"$",language:"en",maxRetries:2,maxRows:5e3,metadata:!1,nodeEnabled:!1,nodeCookie:"",nodeServer:"",queryLimit:null,retryAfter:1e3},l=null,t=/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i,r=0;function p(e){var t="("+(e=e||{}).status+") "+e.responseText;try{JSON.parse(e.responseText).error.code.split(",")[0],t="("+e.status+") "+JSON.parse(e.responseText).error.message.value}catch(e){0}return t}this.sprLib={},sprLib.version="1.9.0-beta-20181202",sprLib.options=function(e){if(!(e&&"object"==typeof e&&(e.hasOwnProperty("baseUrl")||e.hasOwnProperty("queryLimit")||e.hasOwnProperty("nodeEnabled")||e.hasOwnProperty("nodeCookie")||e.hasOwnProperty("nodeServer"))))return{baseUrl:c.baseUrl,nodeCookie:c.nodeCookie,nodeEnabled:c.nodeEnabled,nodeServer:c.nodeServer,queryLimit:c.queryLimit};if(e.baseUrl&&"string"!=typeof e.baseUrl)console.warn("Warning: `baseUrl` should be a string");else if(e.nodeCookie&&"string"!=typeof e.nodeCookie)console.warn("Warning: `nodeCookie` should be a string");else if(e.nodeEnabled&&"boolean"!=typeof e.nodeEnabled)console.warn("Warning: `nodeEnabled` should be a boolean");else if(e.nodeServer&&"string"!=typeof e.nodeServer)console.warn("Warning: `nodeServer` should be a string");else{if(!e.queryLimit||"number"==typeof e.queryLimit)return e.baseUrl&&(c.baseUrl=e.baseUrl.replace(/\/+$/,"")),e.nodeCookie&&(c.nodeCookie=e.nodeCookie),e.nodeServer&&(c.nodeServer=e.nodeServer),"boolean"==typeof e.nodeEnabled&&(c.nodeEnabled=e.nodeEnabled),void 0!==e.queryLimit&&(c.queryLimit=e.queryLimit),{baseUrl:c.baseUrl,nodeCookie:c.nodeCookie,nodeEnabled:c.nodeEnabled,nodeServer:c.nodeServer,queryLimit:c.queryLimit};console.warn("Warning: `queryLimit` should be a number")}},sprLib.baseUrl=function(e){if("string"!=typeof e||""==e||!e)return c.baseUrl;c.baseUrl=e.replace(/\/+$/,"")},sprLib.nodeConfig=function(e){e=e&&"object"==typeof e?e:{},c.nodeEnabled=void 0===e.nodeEnabled||e.nodeEnabled,c.nodeCookie=e.cookie||"",c.nodeServer=e.server||""},sprLib.renewSecurityToken=function(){return new Promise(function(r,t){sprLib.rest({url:"_api/contextinfo",type:"POST"}).then(function(e){var t=e&&e[0]&&e[0].GetContextWebInformation&&e[0].GetContextWebInformation.FormDigestValue?e[0].GetContextWebInformation.FormDigestValue:null;"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&(document.getElementById("__REQUESTDIGEST").value=t),r(t)}).catch(function(e){t(e)})})},sprLib.file=function(e){var t={},n="";(e=e||{}).requestDigest||"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&document.getElementById("__REQUESTDIGEST").value;if(e&&"string"==typeof e)n=encodeURI(e);else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'fileName' is required! EX: `sprLib.file('Documents/Sample.docx')` or `sprLib.file({ 'name':'Documents/Sample.docx' })`"),console.error("ARGS:"),console.error(e),null;n=encodeURI(e.name)}return n=n.replace(/\/$/gi,""),_fileName=n.substring(n.lastIndexOf("/")+1),0!=n.indexOf("/")&&_spPageContextInfo&&_spPageContextInfo.webServerRelativeUrl&&(n=_spPageContextInfo.webServerRelativeUrl+n),t.checkin=function(e){return new Promise(function(t,r){(e=e||{}).comment=e.comment||"",e.type&&-1==["major","minor","overwrite"].indexOf(e.type.toLowerCase())?(console.warn("Check your options! Available checkin() `type` options are: `major`,`minor`,`overwrite`"),e.type="1"):e.type=(e.type||"major").toLowerCase().replace("major",1).replace("minor",0).replace("overwrite",2),sprLib.rest({type:"POST",url:"_api/web/GetFileByServerRelativeUrl('"+n+"')/CheckIn(comment='"+e.comment+"',checkintype="+e.type+")"}).then(function(e){t(!0)}).catch(function(e){r(e)})})},t.checkout=function(){return new Promise(function(t,r){sprLib.rest({type:"POST",url:"_api/web/GetFileByServerRelativeUrl('"+n+"')/CheckOut"}).then(function(e){t(!0)}).catch(function(e){r(e)})})},t.delete=function(){return new Promise(function(t,r){sprLib.rest({type:"POST",headers:{"X-HTTP-Method":"DELETE"},url:"_api/web/GetFileByServerRelativeUrl('"+n+"')",metadata:!1}).then(function(e){t(!0)}).catch(function(e){r(e)})})},t.get=function(){return new Promise(function(t,r){sprLib.rest({url:"_api/web/GetFileByServerRelativeUrl('"+n+"')/$value",headers:{binaryStringResponseBody:!0}}).then(function(e){"undefined"!=typeof Blob?t(new Blob([e],{type:"application/octet-stream"})):t(Buffer.from(e,"binary"))}).catch(function(e){r(e)})})},t.info=function(i){return new Promise(function(e,t){var r={};if(i&&i.hasOwnProperty("version")&&isNaN(Number(i.version)))return console.error("ERROR: 'version' should be a number! EX: `sprLib.file('Sample.docx').info({ version:12 })`"),console.error("ARGS:"),console.error(i),null;sprLib.rest({url:"_api/web/GetFileByServerRelativeUrl('"+n+"')",queryCols:["Author/Id","CheckedOutByUser/Id","LockedByUser/Id","ModifiedBy/Id","CheckInComment","CheckOutType","ETag","Exists","Length","MajorVersion","MinorVersion","Name","ServerRelativeUrl","TimeCreated","TimeLastModified","UniqueId","UIVersionLabel"],metadata:!1}).then(function(e){return r=e&&0<e.length?e[0]:{},["Author","CheckedOutByUser","LockedByUser","ModifiedBy"].forEach(function(e){r[e]&&r[e].__deferred&&delete r[e].__deferred,r[e]&&r[e].__metadata&&delete r[e].__metadata,r[e]&&Array.isArray(r[e])&&0==r[e].length&&(r[e]={})}),r.TimeCreated&&(r.Created=r.TimeCreated,delete r.TimeCreated),r.TimeLastModified&&(r.Modified=r.TimeLastModified,delete r.TimeLastModified),i&&i.version?sprLib.rest({url:"_api/web/GetFileByServerRelativeUrl('"+n+"')/versions("+512*Number(i.version)+")",queryCols:["CheckInComment","Created","IsCurrentVersion","Length","VersionLabel"],metadata:!1}).catch(function(e){throw e}):null}).then(function(t){t&&t[0]&&t[0].VersionLabel&&(Object.keys(t[0]).forEach(function(e){"VersionLabel"!=e&&(r[e]=t[0][e])}),r.MajorVersion=t[0].VersionLabel.split(".")[0],r.MinorVersion=t[0].VersionLabel.split(".")[1],r.UIVersionLabel=t[0].VersionLabel),e(r)}).catch(function(e){t(e)})})},t.perms=function(){return new Promise(function(t,r){sprLib.rest({url:"_api/web/GetFileByServerRelativeUrl('"+n+"')/ListItemAllFields/RoleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=u[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},t.recycle=function(){return new Promise(function(t,r){sprLib.rest({type:"POST",url:"_api/web/GetFileByServerRelativeUrl('"+n+"')/recycle()",metadata:!1}).then(function(e){t(!0)}).catch(function(e){r(e)})})},t},sprLib.folder=function(e){var t={},a="";if((e=e||{})&&"string"==typeof e)a=encodeURI(e);else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'folderName' is required! EX: `sprLib.folder('Documents/Finance')` or `sprLib.folder({ 'name':'Documents/Finance' })`"),console.error("ARGS:"),console.error(e),null;a=encodeURI(e.name)}return a=a.replace(/\/$/gi,""),t.add=function(n){return new Promise(function(r,t){var e,i=0==c.baseUrl.indexOf("http")||0==c.baseUrl.indexOf("/")?c.baseUrl:_spPageContextInfo&&_spPageContextInfo.webServerRelativeUrl?_spPageContextInfo.webServerRelativeUrl:c.baseUrl;if(!(n=n||null)||"string"!=typeof n)return console.error("Error: `folder().add()` requires a string folder name!"),null;e=0==n.indexOf("http")||0==n.indexOf("/")?n:encodeURI(a+"/"+n),sprLib.rest({type:"POST",url:i+"/_api/web/folders/add('"+e+"')",metadata:!1}).then(function(e){var t=e&&e[0]?e[0]:null;r(t)}).catch(function(e){t(e)})})},t.delete=function(){return new Promise(function(t,r){sprLib.rest({type:"POST",headers:{"X-HTTP-Method":"DELETE"},url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')",metadata:!1}).then(function(e){t(!0)}).catch(function(e){r(e)})})},t.files=function(){return new Promise(function(t,r){sprLib.rest({url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')/Files",queryCols:["Author/Id","CheckedOutByUser/Id","LockedByUser/Id","ModifiedBy/Id","Author/Title","CheckedOutByUser/Title","LockedByUser/Title","ModifiedBy/Title","CheckInComment","CheckOutType","ETag","Exists","Length","MajorVersion","MinorVersion","Name","ServerRelativeUrl","TimeCreated","TimeLastModified","Title","UniqueId"],metadata:!1}).then(function(e){e.forEach(function(e){e.Created=e.TimeCreated,delete e.TimeCreated,e.Modified=e.TimeLastModified,delete e.TimeLastModified,e.Length&&!isNaN(Number(e.Length))&&(e.Length=Number(e.Length)),e.CheckedOutByUser&&Array.isArray(e.CheckedOutByUser)&&0==e.CheckedOutByUser.length&&(e.CheckedOutByUser=null),e.LockedByUser&&Array.isArray(e.LockedByUser)&&0==e.LockedByUser.length&&(e.LockedByUser=null)}),t(e||[])}).catch(function(e){r(e)})})},t.folders=function(){return new Promise(function(t,r){sprLib.rest({url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')/Folders",queryCols:["Name","ItemCount","ServerRelativeUrl","Properties/vti_x005f_timecreated","Properties/vti_x005f_timelastmodified","Properties/vti_x005f_hassubdirs","Properties/vti_x005f_isbrowsable","Properties/vti_x005f_foldersubfolderitemcount","Properties/vti_x005f_listname"],metadata:!1}).then(function(e){e.forEach(function(e){e.Properties&&(e.Created=e.Properties.vti_x005f_timecreated?e.Properties.vti_x005f_timecreated:null,e.FolderCount=e.Properties.vti_x005f_foldersubfolderitemcount?e.Properties.vti_x005f_foldersubfolderitemcount:0,e.ItemCount=e.ItemCount?e.ItemCount:0,e.GUID=e.Properties.vti_x005f_listname?e.Properties.vti_x005f_listname:null,e.HasSubdirs=!!e.Properties.vti_x005f_hassubdirs&&"true"==e.Properties.vti_x005f_hassubdirs,e.Hidden=!!e.Properties.vti_x005f_isbrowsable&&"false"==e.Properties.vti_x005f_isbrowsable,e.Modified=e.Properties.vti_x005f_timelastmodified?e.Properties.vti_x005f_timelastmodified:null,delete e.Properties)}),t(e||[])}).catch(function(e){r(e)})})},t.info=function(){return new Promise(function(t,r){var i=null;sprLib.rest({url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')",queryCols:["Name","ItemCount","ServerRelativeUrl","StorageMetrics/TotalSize","Properties/vti_x005f_parentid","Properties/vti_x005f_listtitle","Properties/vti_x005f_listname","Properties/vti_x005f_timecreated","Properties/vti_x005f_timelastmodified","Properties/vti_x005f_hassubdirs","Properties/vti_x005f_isbrowsable","Properties/vti_x005f_foldersubfolderitemcount"],metadata:!1}).then(function(e){return(i=e&&0<e.length?e[0]:{}).Properties&&(i.Created=i.Properties.vti_x005f_timecreated?i.Properties.vti_x005f_timecreated:null,i.FolderCount=i.Properties.vti_x005f_foldersubfolderitemcount?i.Properties.vti_x005f_foldersubfolderitemcount:0,i.ItemCount=i.ItemCount?i.ItemCount:0,i.ListGUID=i.Properties.vti_x005f_listname?i.Properties.vti_x005f_listname:null,i.HasSubdirs=!!i.Properties.vti_x005f_hassubdirs&&"true"==i.Properties.vti_x005f_hassubdirs,i.Hidden=!!i.Properties.vti_x005f_isbrowsable&&"false"==i.Properties.vti_x005f_isbrowsable,i.Modified=i.Properties.vti_x005f_timelastmodified?i.Properties.vti_x005f_timelastmodified:null,delete i.Properties),i.StorageMetrics&&i.StorageMetrics.TotalSize&&(i.TotalSize=Number(i.StorageMetrics.TotalSize)||0,delete i.StorageMetrics),i.ListGUID?sprLib.rest({url:"_api/web/Lists(guid'"+i.ListGUID.replace(/\{|\}/g,"")+"')/rootFolder/Folders",queryCols:["ListItemAllFields/Id"]}):null}).then(function(e){return e&&e[0]&&e[0].ListItemAllFields&&e[0].ListItemAllFields.Id?sprLib.rest({url:"_api/web/Lists(guid'"+i.ListGUID.replace(/\{|\}/g,"")+"')/items('"+e[0].ListItemAllFields.Id+"')/HasUniqueRoleAssignments"}):null}).then(function(e){e&&e[0]&&(i.HasUniqueRoleAssignments=e[0].HasUniqueRoleAssignments),t(i)}).catch(function(e){r(e)})})},t.perms=function(){return new Promise(function(t,r){sprLib.rest({url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')/Properties",queryCols:["vti_x005f_listtitle"]}).then(function(e){return e&&e[0]&&e[0].vti_x005f_listtitle?e[0].vti_x005f_listtitle:sprLib.rest({url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')/ListItemAllFields/RoleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]})}).then(function(e){"string"==typeof e?t(sprLib.list({baseUrl:a.substring(0,a.lastIndexOf("/")),name:e}).perms()):Array.isArray(e)&&(e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=u[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[]))}).catch(function(e){r(e)})})},t.recycle=function(){return new Promise(function(t,r){sprLib.rest({type:"POST",url:"_api/web/GetFolderByServerRelativeUrl('"+a+"')/recycle()",metadata:!1}).then(function(e){t(!0)}).catch(function(e){r(e)})})},t},sprLib.list=function(a){var e={},l="_api/lists",d=(a=a||{}).requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null);if(a.guid&&(a.name=a.guid),a&&"string"==typeof a)l+=t.test(a)?"(guid'"+a+"')":"/getbytitle('"+a.replace(/\s/gi,"%20")+"')";else{if(!a||"object"!=typeof a||!a.hasOwnProperty("name"))return console.error("ERROR: A List/Library 'name' or 'GUID' is required! EX: `sprLib.list('Employees')` or `sprLib.list({ 'name':'Employees' })`"),console.error("ARGS:"),console.error(a),null;l=a.baseUrl?a.baseUrl.replace(/\/+$/,"")+"/_api/lists":l,l+=t.test(a.name)?"(guid'"+a.name+"')":"/getbytitle('"+a.name.replace(/\s/gi,"%20")+"')"}function o(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=ListItemEntityTypeFullName"}).then(function(e){e&&Array.isArray(e)&&1==e.length?t({type:e[0].ListItemEntityTypeFullName}):r("Invalid result!")}).catch(function(e){r(e)})})}return e.cols=function(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=Fields&$expand=Fields",queryLimit:5e3,metadata:!1}).then(function(e){var r=[];(e&&e[0]&&e[0].Fields&&e[0].Fields.results?e[0].Fields.results:[]).forEach(function(e,t){e.Hidden||"Edit"==e.InternalName||"DocIcon"==e.InternalName||0==e.InternalName.indexOf("_")||r.push({dispName:e.Title,dataName:e.InternalName,dataType:e.TypeAsString,isAppend:e.AppendOnly||!1,isNumPct:-1<e.SchemaXml.toLowerCase().indexOf('percentage="true"'),isReadOnly:e.ReadOnlyField,isRequired:e.Required,isUnique:e.EnforceUniqueValues,defaultValue:e.DefaultValue||null,maxLength:e.MaxLength||null,choiceValues:e.Choices&&e.Choices.results?e.Choices.results:null,allowFillInChoices:1==e.FillInChoice||0==e.FillInChoice?e.FillInChoice:null})}),t(r)}).catch(function(e){r(e)})})},e.info=function(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=Id,AllowContentTypes,BaseTemplate,BaseType,Created,Description,DraftVersionVisibility,EnableAttachments,EnableFolderCreation,EnableVersioning,ForceCheckout,HasUniqueRoleAssignments,Hidden,ItemCount,LastItemDeletedDate,LastItemModifiedDate,LastItemUserModifiedDate,ListItemEntityTypeFullName,Title",metadata:!1}).then(function(e){t(e&&0<e.length?e[0]:[])}).catch(function(e){r(e)})})},e.perms=function(e){return new Promise(function(t,r){sprLib.rest({url:l+"/RoleAssignments?$select=",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=u[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},e.items=function(o){var s="";return new Promise(function(t,n){if(""!=(o=o||{})&&o!=[]||(o={}),o.queryFilter&&(o.queryFilter=o.queryFilter.replace(/\"/gi,"'")),"string"==typeof o||"number"==typeof o){var e={};e[o.toString()]={dataName:o.toString()},o={listCols:e}}else if(Array.isArray(o)){var i={};o.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(i[r]=i[r]?{dataName:i[r].dataName+","+e}:{dataName:e})}),o={listCols:i}}else if("string"==typeof o.listCols){var r={};Object.keys(o).forEach(function(e,t){r[e]=o[e]}),o.listCols=[o.listCols];i={};o.listCols.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(i[r]=i[r]?{dataName:i[r].dataName+","+e}:{dataName:e})}),r.listCols=i,o=r}else if(Array.isArray(o.listCols)){r={};Object.keys(o).forEach(function(e,t){r[e]=o[e]});i={};o.listCols.filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(i[r]=i[r]?{dataName:i[r].dataName+","+e}:{dataName:e})}),r.listCols=i,o=r}else o.listCols||(o.listCols={});o.spArrData=[],o.spObjData={},"object"==typeof o.listCols&&0<Object.keys(o.listCols).length&&Object.keys(o.listCols).forEach(function(e){o.listCols[e].getVersions&&(o.metadata=!0)}),Promise.resolve().then(function(){return new Promise(function(e,t){var i={url:l+"/items",type:"GET",cache:"boolean"==typeof o.cache?o.cache:c.cache,metadata:"boolean"==typeof o.metadata?o.metadata:c.metadata,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}},n=[],a="";o.queryNext&&("object"==typeof o.queryNext&&o.queryNext.prevId&&o.queryNext.maxItems||(o.queryNext=null,console.log('ERROR: queryNext should be an object with `prevId` and `maxItems`. EX: `{"prevId":200,"maxItems":100}`'))),o.queryNext&&o.listCols&&0<Object.keys(o.listCols).length?i.url+="?%24skiptoken=Paged%3dTRUE%26p_ID%3d"+o.queryNext.prevId+"&%24select=":o.listCols&&0<Object.keys(o.listCols).length&&(i.url+="?$select="),Object.keys(o.listCols).forEach(function(e){var t=o.listCols[e];if(t.dataName&&("="==i.url.substring(i.url.length-1)?i.url+=t.dataName:i.url+=i.url.lastIndexOf(",")==i.url.length-1?t.dataName:","+t.dataName,-1<t.dataName.indexOf("/"))){var r=t.dataName.substring(0,t.dataName.indexOf("/"));-1==n.indexOf(r)&&(n.push(r),a+=(""==a?"":",")+r)}}),a&&(i.url+=(-1<i.url.indexOf("?")?"&":"?")+"$expand="+a),o.queryFilter&&(i.url+=(-1<i.url.indexOf("?")?"&":"?")+"$filter="+(-1==o.queryFilter.indexOf("%")?encodeURI(o.queryFilter):o.queryFilter)),o.queryOrderby&&(i.url+=(-1<i.url.indexOf("?")?"&":"?")+"$orderby="+o.queryOrderby),o.queryNext?i.url+="&p_ID="+o.queryNext.prevId+"&$top="+o.queryNext.maxItems:o.queryLimit&&(i.url+=(-1<i.url.indexOf("?$")?"&":"?")+"$top="+o.queryLimit),sprLib.rest(i).then(function(r){if((!o.listCols||0==Object.keys(o.listCols).length)&&0<r.length){var i={};Object.keys(r[0]).forEach(function(e,t){r[0][e]&&"object"==typeof r[0][e]&&r[0][e].__deferred||(i[e]={dataName:e})}),o.listCols=i}r.forEach(function(n,e){var a={},t=0;n.__metadata&&(a.__metadata=n.__metadata,n.__metadata.uri&&(-1<n.__metadata.uri.indexOf("/Items(")&&(t=Number(n.__metadata.uri.split("/Items(").pop().replace(")",""))),!s&&-1<n.__metadata.uri.indexOf("guid'")&&(s=n.__metadata.uri.split("guid'").pop().split("')/")[0]))),n.__next&&(a.__next=n.__next),Object.keys(o.listCols).forEach(function(e){var t=o.listCols[e],r=[],i="";if(t.dataName&&-1<t.dataName.indexOf("/")&&n[t.dataName.split("/")[0]].results){if(a[e])return;i=[],n[t.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,i.push(e)})}else t.dataName&&-1<t.dataName.indexOf("/")?(r=t.dataName.split("/"),n[r[0]].__metadata&&delete n[r[0]].__metadata,n[r[0]].__deferred&&delete n[r[0]].__deferred,(i=e!=r[0]&&e!=t.dataName?n[r[0]][r[1]]:n[r[0]])&&"object"==typeof i&&!Array.isArray(i)&&0==Object.keys(i).length&&(i=null)):t.dataName?i=n[t.dataName]:t.dataFunc&&(i=t.dataFunc(n));"DateTime"==t.dataType?a[e]=new Date(i):a[e]=c.cleanColHtml&&"string"==t.listDataType?i.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):i,t.getVersions&&(a[e]=[])}),o.spArrData.push(a),t&&(o.spObjData[t]=a)}),e()}).catch(function(e){t(e)})})}).then(function(){var r=[],i=[];Object.keys(o.listCols).forEach(function(e){var t=o.listCols[e];t.getVersions&&(t.keyName=e,r.push(t),i.push(t.dataName))}),s&&r.length?sprLib.rest({url:(a.baseUrl?a.baseUrl+"/":"")+"_vti_bin/owssvr.dll?Cmd=Display&List=%7B"+s+"%7D&XMLDATA=TRUE&IncludeVersions=TRUE&Query=ID%20"+i.toString().replace(/\,/g,"%20")+"%20Modified%20Editor%20&SortField=Modified&SortDir=ASC"}).then(function(e){e&&e[0]&&e[0].documentElement&&e[0].documentElement.querySelectorAll("row").forEach(function(a){r.forEach(function(e,t){var r=a.getAttribute("ows_ID"),i="";if(o.spObjData[r]&&a.getAttribute("ows_"+e.dataName)){var n=a.getAttribute("ows_"+e.dataName)||"";n&&(n!=i?(o.spObjData[r][e.keyName].push({verDate:new Date(a.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:a.getAttribute("ows_Editor").substring(a.getAttribute("ows_Editor").indexOf("#")+1),verText:n}),i=n):(o.spObjData[r][e.keyName].pop(),o.spObjData[r][e.keyName].push({verDate:new Date(a.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:a.getAttribute("ows_Editor").substring(a.getAttribute("ows_Editor").indexOf("#")+1),verText:n})))}})}),t(o.spArrData)}).catch(function(e){n(e)}):t(o.spArrData)}).catch(function(e){n(e)})})},e.getItems=e.items,e.create=function(i){return new Promise(function(t,r){i&&!Array.isArray(i)&&"object"==typeof i&&0!=Object.keys(i).length||r("Object type expected! Ex: `{Title:'New Emp'}`");try{JSON.stringify(i)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}i.__metadata=i.__metadata||{},delete i.__metadata.etag,delete i.__next,Promise.resolve().then(function(){return i.__metadata.type?null:o()}).then(function(e){e&&e.type&&(i.__metadata=e),sprLib.rest({type:"POST",url:l+"/items",data:JSON.stringify(i),metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}}).then(function(e){e&&e[0]?(i.Id=e[0].Id,i.ID=e[0].ID,i.__metadata=i.__metadata||e[0].__metadata||{},i.__metadata.etag=i.__metadata.etag||(e[0].__metadata?e[0].__metadata.etag:null)):i=null,t(i)}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},e.update=function(n){return new Promise(function(t,r){n&&!Array.isArray(n)&&"object"==typeof n&&0!=Object.keys(n).length||r("Object type expected! Ex: `{Title:'Brent'}`"),n.ID||n.Id||n.iD||n.id||r("Object must have an `Id` property! Ex: `{Id:99}`");try{JSON.stringify(n)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid object. Ex: `{'Title':'Brent'}`")}var i=n.ID||n.Id||n.iD||n.id;delete n.ID,delete n.Id,delete n.iD,delete n.id,n.__metadata=n.__metadata||{},""!=n.__metadata.etag&&null!=n.__metadata.etag||delete n.__metadata.etag,delete n.__next,Promise.resolve().then(function(){return n.__metadata.type?null:o()}).then(function(e){e&&e.type&&(n.__metadata.type=e.type),sprLib.rest({type:"POST",url:l+"/items("+i+")",data:JSON.stringify(n),metadata:!0,headers:{"X-HTTP-Method":"MERGE",Accept:"application/json;odata=verbose","X-RequestDigest":d,"IF-MATCH":n.__metadata.etag?n.__metadata.etag:"*"}}).then(function(e){n.Id=i,n.ID=i,n.__metadata.etag&&(n.__metadata.etag='"'+(Number(n.__metadata.etag.replace(/[\'\"]+/gi,""))+1)+'"'),t(n)}).catch(function(e){r(e)})})})},e.delete=function(n){return new Promise(function(t,r){n&&!Array.isArray(n)&&"object"==typeof n&&0!=Object.keys(n).length||r("Object type expected! Ex: `{'ID':123}`"),n.ID||n.Id||n.iD||n.id||r("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(n)}catch(e){r("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var i=n.ID||n.Id||n.iD||n.id;delete n.ID,delete n.Id,delete n.iD,delete n.id,n.__metadata=n.__metadata||{},""!=n.__metadata.etag&&null!=n.__metadata.etag||delete n.__metadata.etag,delete n.__next,Promise.resolve().then(function(){return n.__metadata.type?null:o()}).then(function(e){e&&e.type&&(n.__metadata.type=e.type),sprLib.rest({type:"DELETE",url:l+"/items("+i+")",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d,"X-HTTP-Method":"MERGE","IF-MATCH":n.__metadata.etag?n.__metadata.etag:"*"}}).then(function(){t(i)}).catch(function(e){r(e)})})})},e.recycle=function(i){return new Promise(function(e,t){i&&!Array.isArray(i)&&"object"==typeof i&&0!=Object.keys(i).length||t("Object type expected! Ex: `{'ID':123}`"),i.ID||i.Id||i.iD||i.id||t("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(i)}catch(e){t("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var r=i.ID||i.Id||i.iD||i.id;delete i.ID,delete i.Id,delete i.iD,delete i.id,i.__metadata=i.__metadata||{},""!=i.__metadata.etag&&null!=i.__metadata.etag||delete i.__metadata.etag,delete i.__next,sprLib.rest({type:"POST",url:l+"/items("+r+")/recycle()",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}}).then(function(){e(Number(r))}).catch(function(e){t(e)})})},e},sprLib.rest=function(d){return new Promise(function(n,t){(d=d||{}).spArrData=[],d.cache="boolean"==typeof d.cache?d.cache:c.cache,d.digest=d.requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null),d.metadata="boolean"==typeof d.metadata?d.metadata:c.metadata,d.queryLimit=d.queryLimit||c.queryLimit||null,d.type=d.restType||d.type||"GET",d.url=(d.restUrl||d.url||c.baseUrl).replace(/\"/g,"'");var i=[],a="",o={url:d.url,type:d.type,cache:d.cache,headers:d.headers||{Accept:"application/json;odata=verbose","X-RequestDigest":d.digest}};if(d.data&&(o.data=d.data),"POST"==o.type&&(o.headers.contentType||(o.headers["content-type"]="application/json;odata=verbose"),o.headers["X-RequestDigest"]||(o.headers["X-RequestDigest"]=d.digest)),o.url=0==d.url.toLowerCase().indexOf("http")||0==d.url.indexOf("/")?"":c.baseUrl,o.url+=(0!=d.url.toLowerCase().indexOf("http")&&0!=d.url.indexOf("/")?"/":"")+d.url,d.queryCols){if(-1==o.url.toLowerCase().indexOf("$select")&&(o.url+="?$select="),"string"==typeof d.queryCols&&(d.queryCols=[d.queryCols]),Array.isArray(d.queryCols)){var s={};d.queryCols.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;s[r]=s[r]?{dataName:s[r].dataName+","+e}:{dataName:e}}),d.queryCols=s}"object"==typeof d.queryCols&&Object.keys(d.queryCols).forEach(function(e){var t=d.queryCols[e];if(t.dataName&&("="==o.url.substring(o.url.length-1)?o.url+=t.dataName:o.url+=o.url.lastIndexOf(",")==o.url.length-1?t.dataName:","+t.dataName,-1<t.dataName.indexOf("/"))){t.dataName.substring(0,t.dataName.indexOf("/"));var r=t.dataName.substring(0,t.dataName.lastIndexOf("/"));-1==i.indexOf(r)&&(i.push(r),a+=(""==a?"":",")+r)}})}(d.queryFilter||-1<o.url.toLowerCase().indexOf("$select"))&&"GET"==d.type&&-1==d.url.toLowerCase().indexOf("$top")&&d.queryLimit&&(o.url+=(0<o.url.indexOf("?")?"&":"?")+"$top="+d.queryLimit),-1==d.url.toLowerCase().indexOf("$filter")&&d.queryFilter&&(o.url+=(0<o.url.indexOf("?")?"&":"?")+"$filter="+(-1==d.queryFilter.indexOf("%")?encodeURI(d.queryFilter):d.queryFilter)),-1==d.url.toLowerCase().indexOf("$orderby")&&d.queryOrderby&&(o.url+=(0<o.url.indexOf("?")?"&":"?")+"$orderby="+d.queryOrderby),-1==d.url.toLowerCase().indexOf("$expand")&&a&&(o.url+=(0<o.url.indexOf("?")?"&":"?")+"$expand="+a),Promise.resolve().then(function(){return new Promise(function(r,i){if(c.nodeEnabled){if(!l)try{l=require("https")}catch(e){throw console.error("Unable to load `https`"),"LIB-MISSING-HTTPS"}o.headers.Cookie=c.nodeCookie,o.data&&(o.headers["Content-Length"]=o.data.length);var e={hostname:c.nodeServer,path:o.url,method:o.type,headers:o.headers},t=l.request(e,function(e){var t="";e.setEncoding(d.headers&&d.headers.binaryStringResponseBody?"binary":"utf8"),e.on("data",function(e){t+=e}),e.on("end",function(){-1<t.indexOf("HTTP Error")?i():-1<t.indexOf('{"error"')&&-1<t.indexOf('{"code"')?i(JSON.parse(t).error.message.value+"\n\nURL used: "+o.url):r(t)}),e.on("error",function(e){i(JSON.parse(t).error.message.value+"\n\nURL used: "+o.url)})});o.data&&t.write(o.data),t.end()}else{t=new XMLHttpRequest;d.headers&&d.headers.binaryStringResponseBody&&(t.responseType="arraybuffer"),t.open(o.type,o.url,!0),Object.keys(o.headers||{}).forEach(function(e){t.setRequestHeader(e,o.headers[e])}),t.onload=function(){200<=t.status&&t.status<400?d.headers&&d.headers.binaryStringResponseBody?r(t.response):r(t.responseXML||t.responseText):i(p(t)+"\n\nURL used: "+o.url)},t.onerror=function(){i(p(t)+"\n\nURL used: "+o.url)},t.send(o.data?o.data:null)}}).catch(function(e){t(e)})}).then(function(e){if(d.headers&&d.headers.binaryStringResponseBody)n(e);else{var t=(e="string"==typeof e&&0==e.indexOf("{")?JSON.parse(e):e)&&e.d&&!e.d.results&&"object"==typeof e.d&&0<Object.keys(e.d).length?[e.d]:[];if(-1<o.url.toLowerCase().indexOf("owssvr.dll")&&-1<o.url.toLowerCase().indexOf("includeversions=true"))d.spArrData.push(e);else if(0<t.length||e&&e.d&&e.d.results&&"object"==typeof e.d.results)(0<t.length?t:e.d.results).forEach(function(l){var r={};if(d.queryCols?Array.isArray(d.queryCols)?d.queryCols.forEach(function(e){r[e]=c.cleanColHtml&&"string"==col.listDataType?colVal.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):colVal}):Object.keys(d.queryCols).forEach(function(a){var o=d.queryCols[a],e=[],s="";if(o.dataName&&-1<o.dataName.indexOf("/")&&l[o.dataName.split("/")[0]]&&l[o.dataName.split("/")[0]].results){if(r[a])return;s=[],l[o.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,s.push(e)})}else o.dataName&&-1<o.dataName.indexOf("/")?(o.dataName.split(",").forEach(function(e,t){var r=e.split("/");l[r[0]]&&l[r[0]].__metadata&&delete l[r[0]].__metadata,l[r[0]]&&l[r[0]].__deferred&&delete l[r[0]].__deferred;var i=null;if(2==r.length)(i=l[r[0]])&&"object"==typeof i&&"results"==Object.keys(i)[0]&&(l[r[0]]=i.results),s=a!=r[0]&&a!=o.dataName?l[r[0]][r[1]]:l[r[0]];else if(3==r.length)(i=l[r[0]][r[1]])&&"object"==typeof i&&"results"==Object.keys(i)[0]&&(l[r[0]][r[1]]=i.results),s=a!=r[0]&&a!=o.dataName?l[r[0]][r[1]][r[2]]:l[r[0]];else if(4==r.length){var n="";Array.isArray(l[r[0]][r[1]])?n=l[r[0]][r[1]]:l[r[0]]&&l[r[0]][r[1]]&&l[r[0]][r[1]][r[2]]?n=l[r[0]][r[1]][r[2]]:l[r[0]]&&l[r[0]][r[1]]&&l[r[0]][r[1]][r[2]]&&l[r[0]][r[1]][r[2]][r[3]]&&(n=l[r[0]][r[1]][r[2]][r[3]]),s=a!=r[0]&&a!=o.dataName?n:l[r[0]]}else 4<r.length&&console.log("This is madness!!")}),"object"!=typeof s||Array.isArray(s)||0!=Object.keys(s).length||(s=[])):o.dataName&&(e=o.dataName.split("/"),s=1<e.length?l[e[0]][e[1]]:l[e[0]]);"DateTime"==o.dataType?r[a]=new Date(s):r[a]=c.cleanColHtml&&"string"==o.listDataType?s.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):s}):Object.keys(l).forEach(function(e){var t=l[e];r[e]=t}),r.__metadata&&!d.metadata&&delete r.__metadata,e.d.__next){var i={prevId:"",maxItems:""};e.d.__next.split("&").forEach(function(e,t){-1<e.indexOf("p_ID%3d")?i.prevId=e.split("&")[0].split("%3d")[2]:-1<e.indexOf("%24top=")&&(i.maxItems=e.substring(e.lastIndexOf("=")+1))}),i.prevId&&i.maxItems&&(r.__next=i)}d.spArrData.push(r)});else if((e&&e.d?e.d:e||0)&&"object"==typeof(e.d||e)&&0<Object.keys(e.d||e).length){var r={},i=e.d||e;Object.keys(i).forEach(function(e){var t=i[e];r[e]=t}),r.__metadata&&!d.metadata&&delete r.__metadata,d.spArrData.push(r)}n(d.spArrData)}}).catch(function(e){!c.nodeEnabled&&"string"==typeof e&&-1<e.indexOf("(403)")&&r<=c.maxRetries?Promise.resolve().then(function(){return sprLib.renewSecurityToken()}).then(function(){var e=document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null;d.headers&&d.headers["X-RequestDigest"]&&(d.headers["X-RequestDigest"]=e),r++,sprLib.rest(d)}):(r=0,t(e))})})},sprLib.site=function(o){var e={},s=o?(o+"/").replace(/\/+$/g,"/"):"";return e.info=function(){return new Promise(function(r,t){Promise.all([sprLib.rest({url:s+"_api/web",queryCols:["Id","Title","Description","Language","Created","LastItemModifiedDate","LastItemUserModifiedDate","RequestAccessEmail","SiteLogoUrl","Url","WebTemplate","AssociatedOwnerGroup/Id","AssociatedMemberGroup/Id","AssociatedVisitorGroup/Id","AssociatedOwnerGroup/OwnerTitle","AssociatedMemberGroup/OwnerTitle","AssociatedVisitorGroup/OwnerTitle","AssociatedOwnerGroup/Title","AssociatedMemberGroup/Title","AssociatedVisitorGroup/Title"],cache:!1}),sprLib.rest({url:s+"_api/site",queryCols:["Owner/Email","Owner/LoginName","Owner/Title","Owner/IsSiteAdmin"],cache:!1})]).then(function(e){var t=e[0][0];t.Owner=e[1][0].Owner,delete t.Owner.__metadata,delete t.AssociatedMemberGroup.__metadata,delete t.AssociatedOwnerGroup.__metadata,delete t.AssociatedVisitorGroup.__metadata,t.hasOwnProperty("LastItemUserModifiedDate")&&!t.LastItemUserModifiedDate&&delete t.LastItemUserModifiedDate,r(t)}).catch(function(e){t(e)})})},e.lists=function(){return new Promise(function(t,r){sprLib.rest({url:s+"_api/web/lists",queryCols:["Id","Title","Description","ItemCount","BaseType","BaseTemplate","Hidden","ImageUrl","ParentWebUrl","RootFolder/ServerRelativeUrl"]}).then(function(e){e.forEach(function(e,t){e.ServerRelativeUrl=e.RootFolder&&e.RootFolder.ServerRelativeUrl?e.RootFolder.ServerRelativeUrl:null,e.RootFolder&&delete e.RootFolder,e.BaseType=i[e.BaseType]||e.BaseType}),t(e||[])}).catch(function(e){r(e)})})},e.subsites=function(){return new Promise(function(t,r){sprLib.rest({url:s+"_api/web/webs",queryCols:{Id:{dataName:"Id",dispName:"Id"},Name:{dataName:"Title",dispName:"Subsite Name"},UrlAbs:{dataName:"Url",dispName:"Absolute URL"},UrlRel:{dataName:"ServerRelativeUrl",dispName:"Relative URL"},Created:{dataName:"Created",dispName:"Date Created"},Modified:{dataName:"LastItemModifiedDate",dispName:"Date Last Modified"},Language:{dataName:"Language",dispName:"Language"},SiteLogoUrl:{dataName:"SiteLogoUrl",dispName:"Site Logo URL"}}}).then(function(e){t(e||[])}).catch(function(e){r(e)})})},e.perms=function(){return new Promise(function(t,r){sprLib.rest({url:s+"_api/web/roleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=u[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},e.roles=function(){return new Promise(function(t,r){sprLib.rest({url:s+"_api/web/roleDefinitions",queryCols:["Id","Name","Description","RoleTypeKind","Hidden"]}).then(function(e){t(e||[])}).catch(function(e){r(e)})})},e.groups=function(n){return new Promise(function(t,r){var i=[];if(n&&0<Object.keys(n).length&&!n.hasOwnProperty("id")&&!n.hasOwnProperty("title")&&(console.warn("Warning..: Check your options! Available `site().groups()` options are: `id`,`title`"),console.warn("Result...: Invalid filter option: All site groups will be returned"),n=null),o){var e="Member/PrincipalType eq 8";n&&n.id?e="Member/Id eq "+n.id:n&&n.title&&(e="Member/Title eq '"+n.title+"'"),sprLib.rest({url:s+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Description","Member/OwnerTitle","Member/PrincipalType","Member/AllowMembersEditMembership","Member/Users/Id","Member/Users/LoginName","Member/Users/Title"],queryFilter:e,queryLimit:c.maxRows}).then(function(e){e.forEach(function(e,t){i.push({Id:e.Member.Id,Title:e.Member.Title,Description:e.Member.Description,OwnerTitle:e.Member.OwnerTitle,PrincipalType:u[e.Member.PrincipalType]||e.Member.PrincipalType,AllowMembersEditMembership:e.Member.AllowMembersEditMembership,Users:e.Member.Users.map(function(e){return e.__metadata&&delete e.__metadata,e})})}),t(i||[])}).catch(function(e){r(e)})}else{e="";n&&n.id?e="Id eq "+n.id:n&&n.title&&(e="Title eq '"+n.title+"'"),sprLib.rest({url:s+"_api/web/SiteGroups",queryCols:["Id","Title","Description","OwnerTitle","PrincipalType","AllowMembersEditMembership","Users/Id","Users/LoginName","Users/Title"],queryFilter:e,queryLimit:c.maxRows}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("SharingLinks")})),e.forEach(function(e,t){e.PrincipalType=u[e.PrincipalType]||e.PrincipalType}),t(e||[])}).catch(function(e){r(e)})}})},e.users=function(a){return new Promise(function(n,t){a&&0<Object.keys(a).length&&!a.hasOwnProperty("id")&&!a.hasOwnProperty("title")&&(console.warn("Warning..: Check your options! Available `site().users()` options are: `id`,`title`"),console.warn("Result...: Invalid filter option: All site users will be returned"),a=null),o?Promise.all([sprLib.rest({url:s+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Email","Member/LoginName","Member/Title","Member/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 1",queryLimit:c.maxRows}),sprLib.rest({url:s+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Users/Id","Member/Users/Email","Member/Users/LoginName","Member/Users/Title","Member/Users/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 8",queryLimit:c.maxRows})]).then(function(e){var r=[],i={};e[0].forEach(function(e){e.Member.Groups=[],(!a||a&&a.id&&a.id==e.Member.Id||a&&a.title&&a.title==e.Member.Title)&&(r.push(e.Member),i[e.Member.Id]=e.Member)}),e[1].forEach(function(t){t.Member.Users&&0<t.Member.Users.length&&t.Member.Users.forEach(function(e){e.__metadata&&delete e.__metadata,(!a||a&&a.id&&a.id==e.Id||a&&a.title&&a.title==e.Title)&&(e.Groups||(e.Groups=[]),e.Groups.push({Id:t.Member.Id,Title:t.Member.Title}),i[e.Id]?(i[e.Id].Groups||(i[e.Id].Groups=[]),i[e.Id].Groups.push({Id:t.Member.Id,Title:t.Member.Title})):(r.push(e),i[e.Id]=t.Member))})}),n(r||[])}).catch(function(e){t(e)}):sprLib.rest({url:s+"_api/web/SiteUsers",queryCols:["Id","Email","LoginName","Title","IsSiteAdmin","Groups/Id","Groups/Title"],queryFilter:"PrincipalType eq 1",queryLimit:c.maxRows}).then(function(e){var t=[];e.forEach(function(e){(!a||a&&a.id&&a.id==e.Id||a&&a.title&&a.title==e.Title)&&-1==e.Title.indexOf("spocrwl")&&e.Id<1e9&&t.push(e)}),n(t||[])}).catch(function(e){t(e)})})},e},sprLib.user=function(a){var e={},t="_api/Web",o="_api",i="/CurrentUser?";return!(a&&0<Object.keys(a).length)||a.hasOwnProperty("id")||a.hasOwnProperty("email")||a.hasOwnProperty("login")||a.hasOwnProperty("title")||a.hasOwnProperty("baseUrl")||(console.warn("Warning: Unknown option(s) passed. Available `user()` options are: `baseUrl`,`id`,`email`,`login`,`title`"),console.warn("Result: The current user is being returned"),a={}),(a=a||{}).hasOwnProperty("baseUrl")&&(t=a.baseUrl.toString().replace(/\/+$/,"")+"/_api/Web",o=a.baseUrl.toString().replace(/\/+$/,"")+"/_api"),a&&a.id?i="/siteusers?$filter=Id%20eq%20"+a.id+"&":a&&a.email?i="/siteusers?$filter=Email%20eq%20%27"+a.email+"%27&":a&&a.login?i="/siteusers?$filter=LoginName%20eq%20%27"+a.login.replace(/#/g,"%23")+"%27&":a&&a.title&&(i="/siteusers?$filter=Title%20eq%20%27"+a.title+"%27&"),i=t+i,e.info=function(){return new Promise(function(e,t){sprLib.rest({url:i+"$select=Id,Title,Email,LoginName,IsSiteAdmin,PrincipalType",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(r){var i={};(r&&Array.isArray(r)&&r[0]&&0<Object.keys(r[0]).length?Object.keys(r[0]):[]).forEach(function(e,t){i[e]=r[0][e]}),e(i)}).catch(function(e){t(e)})})},e.groups=function(){return new Promise(function(t,r){sprLib.rest({url:i+"$select=Groups/Id,Groups/Title,Groups/Description,Groups/LoginName,Groups/OwnerTitle&$expand=Groups",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(e){var r=[];(e&&e[0]&&e[0].Groups&&e[0].Groups.results?e[0].Groups.results:[]).forEach(function(e,t){r.push({Id:e.Id,Title:e.Title,Description:e.Description,OwnerTitle:e.OwnerTitle,LoginName:e.LoginName})}),t(r)}).catch(function(e){r(e)})})},e.profile=function(e){return new Promise(function(i,t){var n=Array.isArray(e)?e:"string"==typeof e?[e]:null,r=a&&a.login?encodeURIComponent(a.login):null;Promise.resolve().then(function(){if(a&&!a.login)return sprLib.user(a).info()}).then(function(e){return e&&(r=encodeURIComponent(e.LoginName)),r?Array.isArray(n)&&1==n.length?sprLib.rest({url:o+"/SP.UserProfiles.PeopleManager/GetUserProfilePropertyFor(accountName=@v,propertyname='"+n[0]+"')?@v='"+r+"'",metadata:!1}):Array.isArray(n)&&1<n.length?sprLib.rest({url:o+"/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)/UserProfileProperties?@v='"+r+"'",metadata:!1}):sprLib.rest({url:o+"/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='"+r+"'",metadata:!1}):sprLib.rest({url:o+"/SP.UserProfiles.PeopleManager/GetMyProperties",metadata:!1})}).then(function(e){var r={};if(e&&e[0]&&e[0].hasOwnProperty("GetPropertiesFor")&&i({}),e&&e[0]&&n&&1==n.length&&e[0].hasOwnProperty("GetUserProfilePropertyFor")?r[n[0]]=e[0].GetUserProfilePropertyFor||"`"+n[0]+"` property does not exist in SP.UserProfiles.PeopleManager.UserProfileProperties":e[0]&&Array.isArray(n)&&0<n.length?n.forEach(function(t){e[0][t]?r[t]=e[0][t]:e[0].UserProfileProperties&&e[0].UserProfileProperties.results&&0<e[0].UserProfileProperties.results.filter(function(e){return e.Key==t}).length?r[t]=e[0].UserProfileProperties.results.filter(function(e){return e.Key==t})[0].Value:r[t]="`"+t+"` property does not exist in SP.UserProfiles.PeopleManager or SP.UserProfiles.PeopleManager.UserProfileProperties"}):e[0]&&(r=e[0]),Object.keys(r).forEach(function(e){r[e]&&r[e].__metadata&&delete r[e].__metadata,r[e]&&r[e].ValueType&&delete r[e].ValueType,"UserProfileProperties"==e&&(r[e]=r[e].results),r[e]&&r[e].results&&(r[e]=r[e].results)}),r.UserProfileProperties){var t={};r.UserProfileProperties.forEach(function(e){t[e.Key]=e.Value}),r.UserProfileProperties=t}i(0==Object.keys(r).length?{}:r)}).catch(function(e){t(e)})})},e}}(),"undefined"!=typeof window&&window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||window;for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),"undefined"!=typeof module&&module.exports&&(module.exports=sprLib);