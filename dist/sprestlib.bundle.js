/* SpRestLib 1.7.0-beta-20180510 */
!function(e){function i(){}function a(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(e,this)}function n(r,i){for(;3===r._state;)r=r._value;return 0===r._state?void r._deferreds.push(i):(r._handled=!0,void a._immediateFn(function(){var e=1===r._state?i.onFulfilled:i.onRejected;if(null!==e){var t;try{t=e(r._value)}catch(e){return void o(i.promise,e)}s(i.promise,t)}else(1===r._state?s:o)(i.promise,r._value)}))}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof a)return t._state=3,t._value=e,void l(t);if("function"==typeof r)return void u((i=r,n=e,function(){i.apply(n,arguments)}),t)}t._state=1,t._value=e,l(t)}catch(e){o(t,e)}var i,n}function o(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&a._immediateFn(function(){e._handled||a._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)n(e,e._deferreds[t]);e._deferreds=null}function d(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function u(e,t){var r=!1;try{e(function(e){r||(r=!0,s(t,e))},function(e){r||(r=!0,o(t,e))})}catch(e){if(r)return;r=!0,o(t,e)}}var t=setTimeout;a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var r=new this.constructor(i);return n(this,new d(e,t,r)),r},a.all=function(e){var o=Array.prototype.slice.call(e);return new a(function(i,n){function a(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if("function"==typeof r)return void r.call(e,function(e){a(t,e)},n)}o[t]=e,0==--s&&i(o)}catch(e){n(e)}}if(0===o.length)return i([]);for(var s=o.length,e=0;e<o.length;e++)a(e,o[e])})},a.resolve=function(t){return t&&"object"==typeof t&&t.constructor===a?t:new a(function(e){e(t)})},a.reject=function(r){return new a(function(e,t){t(r)})},a.race=function(n){return new a(function(e,t){for(var r=0,i=n.length;r<i;r++)n[r].then(e,t)})},a._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},a._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},a._setImmediateFn=function(e){a._immediateFn=e},a._setUnhandledRejectionFn=function(e){a._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=a:e.Promise||(e.Promise=a)}(this);var NODEJS=!1;if("undefined"!=typeof module&&module.exports&&"function"==typeof require)try{require.resolve("https"),NODEJS=!0}catch(e){NODEJS=!1}if(function(){var u=!1,i={0:"List",1:"Library",3:"Discussion Board",4:"Survey",5:"Issue"},c={0:"None",1:"User",2:"Distribution List",4:"Security Group",8:"SharePoint Group",15:"All"},f={baseUrl:"..",busySpinnerHtml:'<div class="sprlib-spinner"><div class="sprlib-bounce1"></div><div class="sprlib-bounce2"></div><div class="sprlib-bounce3"></div></div>',cache:!1,cleanColHtml:!0,currencyChar:"$",language:"en",maxRetries:2,maxRows:5e3,metadata:!1,nodeCookie:"",nodeEnabled:!0,nodeServer:"",retryAfter:1e3},r=/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i,d=0;function p(t){var e="("+(t=t||{}).status+") "+t.responseText;try{JSON.parse(t.responseText).error.code.split(",")[0],e="("+t.status+") "+JSON.parse(t.responseText).error.message.value}catch(e){u&&console.warn("Unable to parse jqXHR response:\n"+t.responseText)}return e}this.sprLib={},sprLib.version="1.7.0-beta-20180510",sprLib.baseUrl=function(e){if("string"!=typeof e||""==e||!e)return f.baseUrl;f.baseUrl=e.replace(/\/+$/,""),u&&console.log("APP_OPTS.baseUrl = "+f.baseUrl)},sprLib.file=function(e){var t={},n="";(e=e||{}).requestDigest||"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&document.getElementById("__REQUESTDIGEST").value;if(e&&"string"==typeof e)n=encodeURI(e);else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'fileName' is required! EX: `sprLib.file('Documents/Sample.docx')` or `sprLib.file({ 'name':'Documents/Sample.docx' })`"),console.error("ARGS:"),console.error(e),null;n=encodeURI(e.name)}return t.info=function(){return new Promise(function(r,t){var e=n.substring(0,n.lastIndexOf("/")),i=n.substring(n.lastIndexOf("/")+1);sprLib.rest({url:"_api/web/GetFolderByServerRelativeUrl('"+e+"')/Files?$select=Author/Id,CheckedOutByUser/Id,LockedByUser/Id,ModifiedBy/Id,CheckInComment,CheckOutType,ETag,Exists,Length,Level,MajorVersion,MinorVersion,Name,ServerRelativeUrl,TimeCreated,TimeLastModified&$expand=Author,CheckedOutByUser,LockedByUser,ModifiedBy&$filter=Name eq '"+i+"'",metadata:!1}).then(function(e){var t=e&&0<e.length?e[0]:{};["Author","CheckedOutByUser","LockedByUser","ModifiedBy"].forEach(function(e){t[e]&&t[e].__deferred&&delete t[e].__deferred,t[e]&&t[e].__metadata&&delete t[e].__metadata}),r(t)}).catch(function(e){t(e)})})},t.upload=function(){return new Promise(function(e,t){})},t},sprLib.folder=function(e){var t={},n="";(e=e||{}).requestDigest||"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&document.getElementById("__REQUESTDIGEST").value;if(e&&"string"==typeof e)n=encodeURI(e);else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'folderName' is required! EX: `sprLib.folder('Documents/Finance')` or `sprLib.folder({ 'name':'Documents/Finance' })`"),console.error("ARGS:"),console.error(e),null;n=encodeURI(e.name)}return n=n.replace(/\/$/gi,""),t.info=function(){return new Promise(function(r,t){var e=n.substring(0,n.lastIndexOf("/")),i=n.substring(n.lastIndexOf("/")+1);sprLib.rest({url:"_api/web/getfolderbyserverrelativeurl('"+e+"')/Folders?$select=Folders/Id,ItemCount,Name,ServerRelativeUrl,WelcomePage,Properties/vti_x005f_timecreated,Properties/vti_x005f_timelastmodified,Properties/vti_x005f_hassubdirs,Properties/vti_x005f_isbrowsable,Properties/vti_x005f_foldersubfolderitemcount,Properties/vti_x005f_listname&$expand=Folders,Properties&$filter=Name eq '"+i+"'",metadata:!1}).then(function(e){var t=e&&0<e.length?e[0]:{};t.Properties.vti_x005f_timecreated&&(t.Created=t.Properties.vti_x005f_timecreated),t.Properties.vti_x005f_listname&&(t.GUID=t.Properties.vti_x005f_listname),t.Properties.vti_x005f_hassubdirs&&(t.HasSubdirs=t.Properties.vti_x005f_hassubdirs),t.Properties.vti_x005f_isbrowsable&&(t.Hidden=!t.Properties.vti_x005f_isbrowsable),t.Properties.vti_x005f_timelastmodified&&(t.LastModifiedDate=t.Properties.vti_x005f_timelastmodified),t.Properties.vti_x005f_foldersubfolderitemcount&&(t.SubFolderItemCount=t.Properties.vti_x005f_foldersubfolderitemcount),t.Properties&&delete t.Properties,r(t)}).catch(function(e){t(e)})})},t},sprLib.list=function(e){var t={},l="_api/lists",d=(e=e||{}).requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null);if(e.guid&&(e.name=e.guid),e&&"string"==typeof e)l+=r.test(e)?"(guid'"+e+"')":"/getbytitle('"+e.replace(/\s/gi,"%20")+"')";else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'listName' or 'listGUID' is required! EX: `sprLib.list('Employees')` or `sprLib.list({ 'name':'Employees' })`"),console.error("ARGS:"),console.error(e),null;l=e.baseUrl?e.baseUrl.replace(/\/+$/,"")+"/_api/lists":l,l+=r.test(e.name)?"(guid'"+e.name+"')":"/getbytitle('"+e.name.replace(/\s/gi,"%20")+"')"}function a(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=ListItemEntityTypeFullName"}).then(function(e){e&&Array.isArray(e)&&1==e.length?t({type:e[0].ListItemEntityTypeFullName}):r("Invalid result!")}).catch(function(e){r(e)})})}return t.cols=function(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=Fields&$expand=Fields",metadata:!1}).then(function(e){var r=[];(e&&e[0]&&e[0].Fields&&e[0].Fields.results?e[0].Fields.results:[]).forEach(function(e,t){e.Hidden||"Edit"==e.InternalName||"DocIcon"==e.InternalName||0==e.InternalName.indexOf("_")||r.push({dispName:e.Title,dataName:e.InternalName,dataType:e.TypeAsString,isAppend:e.AppendOnly||!1,isNumPct:-1<e.SchemaXml.toLowerCase().indexOf('percentage="true"'),isReadOnly:e.ReadOnlyField,isRequired:e.Required,isUnique:e.EnforceUniqueValues,defaultValue:e.DefaultValue||null,maxLength:e.MaxLength||null})}),t(r)}).catch(function(e){r(e)})})},t.info=function(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=Id,AllowContentTypes,BaseTemplate,BaseType,Created,Description,DraftVersionVisibility,EnableAttachments,EnableFolderCreation,EnableVersioning,ForceCheckout,HasUniqueRoleAssignments,Hidden,ItemCount,LastItemDeletedDate,LastItemModifiedDate,LastItemUserModifiedDate,ListItemEntityTypeFullName,Title",metadata:!1}).then(function(e){t(e&&0<e.length?e[0]:[])}).catch(function(e){r(e)})})},t.perms=function(e){return new Promise(function(t,r){sprLib.rest({url:l+"/RoleAssignments?$select=",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=c[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},t.items=function(s){var o="";return new Promise(function(t,n){if(""!=(s=s||{})&&s!=[]||(s={}),s.queryFilter&&(s.queryFilter=s.queryFilter.replace(/\"/gi,"'")),"string"==typeof s||"number"==typeof s){var e={};e[s.toString()]={dataName:s.toString()},s={listCols:e}}else if(Array.isArray(s)){var i={};s.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(i[r]=i[r]?{dataName:i[r].dataName+","+e}:{dataName:e})}),s={listCols:i}}else if("string"==typeof s.listCols){var r={};Object.keys(s).forEach(function(e,t){r[e]=s[e]}),s.listCols=[s.listCols];i={};s.listCols.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(i[r]=i[r]?{dataName:i[r].dataName+","+e}:{dataName:e})}),r.listCols=i,s=r}else if(Array.isArray(s.listCols)){r={};Object.keys(s).forEach(function(e,t){r[e]=s[e]});i={};s.listCols.filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(i[r]=i[r]?{dataName:i[r].dataName+","+e}:{dataName:e})}),r.listCols=i,s=r}else s.listCols||(s.listCols={});s.spArrData=[],s.spObjData={},"object"==typeof s.listCols&&0<Object.keys(s.listCols).length&&Object.keys(s.listCols).forEach(function(e){s.listCols[e].getVersions&&(s.metadata=!0)}),Promise.resolve().then(function(){return new Promise(function(e,t){var i={url:l+"/items",type:"GET",cache:s.cache||f.cache,metadata:s.metadata||f.metadata,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}},n=[],a="";s.queryNext&&("object"==typeof s.queryNext&&s.queryNext.prevId&&s.queryNext.maxItems||(s.queryNext=null,console.log('ERROR: queryNext should be an object with `prevId` and `maxItems`. EX: `{"prevId":200,"maxItems":100}`'))),s.queryNext&&s.listCols&&0<Object.keys(s.listCols).length?i.url+="?%24skiptoken=Paged%3dTRUE%26p_ID%3d"+s.queryNext.prevId+"&%24select=":s.listCols&&0<Object.keys(s.listCols).length&&(i.url+="?$select="),Object.keys(s.listCols).forEach(function(e){var t=s.listCols[e];if(t.dataName&&("="==i.url.substring(i.url.length-1)?i.url+=t.dataName:i.url+=i.url.lastIndexOf(",")==i.url.length-1?t.dataName:","+t.dataName,-1<t.dataName.indexOf("/"))){var r=t.dataName.substring(0,t.dataName.indexOf("/"));-1==n.indexOf(r)&&(n.push(r),a+=(""==a?"":",")+r)}}),a&&(i.url+=(-1<i.url.indexOf("?")?"&":"?")+"$expand="+a),s.queryFilter&&(i.url+=(-1<i.url.indexOf("?")?"&":"?")+"$filter="+(-1==s.queryFilter.indexOf("%")?encodeURI(s.queryFilter):s.queryFilter)),s.queryOrderby&&(i.url+=(-1<i.url.indexOf("?")?"&":"?")+"$orderby="+s.queryOrderby),s.queryNext?i.url+="&p_ID="+s.queryNext.prevId+"&$top="+s.queryNext.maxItems:s.queryLimit&&(i.url+=(-1<i.url.indexOf("?$")?"&":"?")+"$top="+s.queryLimit),sprLib.rest(i).then(function(r){if((!s.listCols||0==Object.keys(s.listCols).length)&&0<r.length){var i={};Object.keys(r[0]).forEach(function(e,t){r[0][e]&&"object"==typeof r[0][e]&&r[0][e].__deferred?u&&console.log('FYI: Skipping "select all" column: '+e):i[e]={dataName:e}}),s.listCols=i}r.forEach(function(n,e){var a={},t=0;n.__metadata&&(a.__metadata=n.__metadata,n.__metadata.uri&&(-1<n.__metadata.uri.indexOf("/Items(")&&(t=Number(n.__metadata.uri.split("/Items(").pop().replace(")",""))),!o&&-1<n.__metadata.uri.indexOf("guid'")&&(o=n.__metadata.uri.split("guid'").pop().split("')/")[0]))),n.__next&&(a.__next=n.__next),Object.keys(s.listCols).forEach(function(e){var t=s.listCols[e],r=[],i="";if(t.dataName&&-1<t.dataName.indexOf("/")&&n[t.dataName.split("/")[0]].results){if(a[e])return;i=[],n[t.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,i.push(e)})}else t.dataName&&-1<t.dataName.indexOf("/")?(r=t.dataName.split("/"),n[r[0]].__metadata&&delete n[r[0]].__metadata,n[r[0]].__deferred&&delete n[r[0]].__deferred,(i=e!=r[0]&&e!=t.dataName?n[r[0]][r[1]]:n[r[0]])&&"object"==typeof i&&!Array.isArray(i)&&0==Object.keys(i).length&&(i=null)):t.dataName?i=n[t.dataName]:t.dataFunc&&(i=t.dataFunc(n));"DateTime"==t.dataType?a[e]=new Date(i):a[e]=f.cleanColHtml&&"string"==t.listDataType?i.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):i,t.getVersions&&(a[e]=[])}),s.spArrData.push(a),t&&(s.spObjData[t]=a)}),e()}).catch(function(e){t(e)})})}).then(function(){var r=[],i=[];Object.keys(s.listCols).forEach(function(e){var t=s.listCols[e];t.getVersions&&(t.keyName=e,r.push(t),i.push(t.dataName))}),o&&r.length?sprLib.rest({url:"_vti_bin/owssvr.dll?Cmd=Display&List=%7B"+o+"%7D&XMLDATA=TRUE&IncludeVersions=TRUE&Query=ID%20"+i.toString().replace(/\,/g,"%20")+"%20Modified%20Editor%20&SortField=Modified&SortDir=ASC"}).then(function(e){e&&e[0]&&e[0].documentElement&&e[0].documentElement.querySelectorAll("row").forEach(function(a){r.forEach(function(e,t){var r=a.getAttribute("ows_ID"),i="";if(s.spObjData[r]&&a.getAttribute("ows_"+e.dataName)){var n=a.getAttribute("ows_"+e.dataName)||"";n&&(n!=i?(s.spObjData[r][e.keyName].push({verDate:new Date(a.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:a.getAttribute("ows_Editor").substring(a.getAttribute("ows_Editor").indexOf("#")+1),verText:n}),i=n):(s.spObjData[r][e.keyName].pop(),s.spObjData[r][e.keyName].push({verDate:new Date(a.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:a.getAttribute("ows_Editor").substring(a.getAttribute("ows_Editor").indexOf("#")+1),verText:n})))}})}),t(s.spArrData)}).catch(function(e){n(e)}):t(s.spArrData)}).catch(function(e){n(e)})})},t.getItems=t.items,t.create=function(i){return new Promise(function(t,r){i&&!Array.isArray(i)&&"object"==typeof i&&0!=Object.keys(i).length||r("Object type expected! Ex: `{Title:'New Emp'}`");try{JSON.stringify(i)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}i.__metadata=i.__metadata||{},delete i.__metadata.etag,delete i.__next,Promise.resolve().then(function(){return i.__metadata.type?null:a()}).then(function(e){e&&e.type&&(i.__metadata=e),sprLib.rest({type:"POST",url:l+"/items",data:JSON.stringify(i),metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}}).then(function(e){e&&e[0]?(i.Id=e[0].Id,i.ID=e[0].ID,i.__metadata=i.__metadata||e[0].__metadata||{},i.__metadata.etag=i.__metadata.etag||(e[0].__metadata?e[0].__metadata.etag:null)):i=null,t(i)}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},t.update=function(n){return new Promise(function(t,r){n&&!Array.isArray(n)&&"object"==typeof n&&0!=Object.keys(n).length||r("Object type expected! Ex: `{Title:'Brent'}`"),n.ID||n.Id||n.iD||n.id||r("Object must have an `Id` property! Ex: `{Id:99}`");try{JSON.stringify(n)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid object. Ex: `{'Title':'Brent'}`")}var i=n.ID||n.Id||n.iD||n.id;delete n.ID,delete n.Id,delete n.iD,delete n.id,n.__metadata=n.__metadata||{},""!=n.__metadata.etag&&null!=n.__metadata.etag||delete n.__metadata.etag,delete n.__next,Promise.resolve().then(function(){return n.__metadata.type?null:a()}).then(function(e){e&&e.type&&(n.__metadata.type=e.type),sprLib.rest({type:"POST",url:l+"/items("+i+")",data:JSON.stringify(n),metadata:!0,headers:{"X-HTTP-Method":"MERGE",Accept:"application/json;odata=verbose","X-RequestDigest":d,"IF-MATCH":n.__metadata.etag?n.__metadata.etag:"*"}}).then(function(e){n.Id=i,n.ID=i,n.__metadata.etag&&(n.__metadata.etag='"'+(Number(n.__metadata.etag.replace(/[\'\"]+/gi,""))+1)+'"'),t(n)}).catch(function(e){r(e)})})})},t.delete=function(n){return new Promise(function(t,r){n&&!Array.isArray(n)&&"object"==typeof n&&0!=Object.keys(n).length||r("Object type expected! Ex: `{'ID':123}`"),n.ID||n.Id||n.iD||n.id||r("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(n)}catch(e){r("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var i=n.ID||n.Id||n.iD||n.id;delete n.ID,delete n.Id,delete n.iD,delete n.id,n.__metadata=n.__metadata||{},""!=n.__metadata.etag&&null!=n.__metadata.etag||delete n.__metadata.etag,delete n.__next,Promise.resolve().then(function(){return n.__metadata.type?null:a()}).then(function(e){e&&e.type&&(n.__metadata.type=e.type),sprLib.rest({type:"DELETE",url:l+"/items("+i+")",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d,"X-HTTP-Method":"MERGE","IF-MATCH":n.__metadata.etag?n.__metadata.etag:"*"}}).then(function(){t(i)}).catch(function(e){r(e)})})})},t.recycle=function(i){return new Promise(function(e,t){i&&!Array.isArray(i)&&"object"==typeof i&&0!=Object.keys(i).length||t("Object type expected! Ex: `{'ID':123}`"),i.ID||i.Id||i.iD||i.id||t("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(i)}catch(e){t("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var r=i.ID||i.Id||i.iD||i.id;delete i.ID,delete i.Id,delete i.iD,delete i.id,i.__metadata=i.__metadata||{},""!=i.__metadata.etag&&null!=i.__metadata.etag||delete i.__metadata.etag,delete i.__next,sprLib.rest({type:"POST",url:l+"/items("+r+")/recycle()",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}}).then(function(){e(Number(r))}).catch(function(e){t(e)})})},t},sprLib.rest=function(l){return new Promise(function(n,t){(l=l||{}).spArrData=[],l.cache=l.cache||f.cache,l.digest=l.requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null),l.metadata=void 0!==l.metadata&&null!=l.metadata?l.metadata:f.metadata,l.type=l.restType||l.type||"GET",l.url=(l.restUrl||l.url||f.baseUrl).replace(/\"/g,"'");var i=[],a="",s={url:l.url,type:l.type,cache:l.cache,headers:l.headers||{Accept:"application/json;odata=verbose","X-RequestDigest":l.digest}};if(l.data&&(s.data=l.data),"POST"!=s.type||s.headers.contentType||(s.headers["content-type"]="application/json;odata=verbose"),s.url=0==l.url.toLowerCase().indexOf("http")||0==l.url.indexOf("/")?"":f.baseUrl,s.url+=(0!=l.url.toLowerCase().indexOf("http")&&0!=l.url.indexOf("/")?"/":"")+l.url,l.queryCols){if(-1==s.url.toLowerCase().indexOf("$select")&&(s.url+="?$select="),"string"==typeof l.queryCols&&(l.queryCols=[l.queryCols]),Array.isArray(l.queryCols)){var o={};l.queryCols.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;o[r]=o[r]?{dataName:o[r].dataName+","+e}:{dataName:e}}),l.queryCols=o}"object"==typeof l.queryCols&&Object.keys(l.queryCols).forEach(function(e){var t=l.queryCols[e];if(t.dataName&&("="==s.url.substring(s.url.length-1)?s.url+=t.dataName:s.url+=s.url.lastIndexOf(",")==s.url.length-1?t.dataName:","+t.dataName,-1<t.dataName.indexOf("/"))){t.dataName.substring(0,t.dataName.indexOf("/"));var r=t.dataName.substring(0,t.dataName.lastIndexOf("/"));-1==i.indexOf(r)&&(i.push(r),a+=(""==a?"":",")+r)}})}(l.queryFilter||-1<s.url.toLowerCase().indexOf("$select"))&&"GET"==l.type&&-1==l.url.toLowerCase().indexOf("$top")&&l.queryLimit&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$top="+l.queryLimit),-1==l.url.toLowerCase().indexOf("$filter")&&l.queryFilter&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$filter="+(-1==l.queryFilter.indexOf("%")?encodeURI(l.queryFilter):l.queryFilter)),-1==l.url.toLowerCase().indexOf("$orderby")&&l.queryOrderby&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$orderby="+l.queryOrderby),-1==l.url.toLowerCase().indexOf("$expand")&&a&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$expand="+a),Promise.resolve().then(function(){return new Promise(function(r,i){if(NODEJS&&f.nodeEnabled){s.headers.Cookie=f.nodeCookie,s.data&&(s.headers["Content-Length"]=s.data.length);var e={hostname:f.nodeServer,path:s.url,method:s.type,headers:s.headers},t=https.request(e,function(e){var t="";e.setEncoding("utf8"),e.on("data",function(e){t+=e}),e.on("end",function(){-1<t.indexOf("HTTP Error")?i():-1<t.indexOf('{"error"')&&-1<t.indexOf('{"code"')?i(JSON.parse(t).error.message.value+"\n\nURL used: "+s.url):r(t)}),e.on("error",function(e){i(JSON.parse(t).error.message.value+"\n\nURL used: "+s.url)})});s.data&&t.write(s.data),t.end()}else{(t=new XMLHttpRequest).open(s.type,s.url,!0),Object.keys(s.headers||{}).forEach(function(e){t.setRequestHeader(e,s.headers[e])}),t.onload=function(){200<=t.status&&t.status<400?r(t.responseXML||t.responseText):i(p(t)+"\n\nURL used: "+s.url)},t.onerror=function(){i(p(t)+"\n\nURL used: "+s.url)},t.send(s.data?s.data:null)}}).catch(function(e){t(e)})}).then(function(e){var t=(e="string"==typeof e&&0==e.indexOf("{")?JSON.parse(e):e)&&e.d&&!e.d.results&&"object"==typeof e.d&&0<Object.keys(e.d).length?[e.d]:[];if(-1<s.url.toLowerCase().indexOf("owssvr.dll")&&-1<s.url.toLowerCase().indexOf("includeversions=true"))l.spArrData.push(e);else if(0<t.length||e&&e.d&&e.d.results&&"object"==typeof e.d.results)(0<t.length?t:e.d.results).forEach(function(o){var r={};if(l.queryCols?Array.isArray(l.queryCols)?l.queryCols.forEach(function(e){r[e]=f.cleanColHtml&&"string"==col.listDataType?colVal.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):colVal}):Object.keys(l.queryCols).forEach(function(n){var a=l.queryCols[n],e=[],s="";if(a.dataName&&-1<a.dataName.indexOf("/")&&o[a.dataName.split("/")[0]]&&o[a.dataName.split("/")[0]].results){if(r[n])return;s=[],o[a.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,s.push(e)})}else a.dataName&&-1<a.dataName.indexOf("/")?(a.dataName.split(",").forEach(function(e,t){var r=e.split("/");o[r[0]]&&o[r[0]].__metadata&&delete o[r[0]].__metadata,o[r[0]]&&o[r[0]].__deferred&&delete o[r[0]].__deferred;var i=null;2==r.length?((i=o[r[0]])&&"object"==typeof i&&"results"==Object.keys(i)[0]&&(o[r[0]]=i.results),s=n!=r[0]&&n!=a.dataName?o[r[0]][r[1]]:o[r[0]]):3==r.length?((i=o[r[0]][r[1]])&&"object"==typeof i&&"results"==Object.keys(i)[0]&&(o[r[0]][r[1]]=i.results),s=n!=r[0]&&n!=a.dataName?o[r[0]][r[1]][r[2]]:o[r[0]]):4==r.length?((i=o[r[0]][r[1]][r[2]])&&"object"==typeof i&&"results"==Object.keys(i)[0]&&(o[r[0]][r[1]][r[2]]=i.results),s=n!=r[0]&&n!=a.dataName?o[r[0]][r[1]][r[2]][r[3]]:o[r[0]]):4<r.length&&console.log("This is madness!!")}),"object"!=typeof s||Array.isArray(s)||0!=Object.keys(s).length||(s=[])):a.dataName&&(e=a.dataName.split("/"),s=1<e.length?o[e[0]][e[1]]:o[e[0]]);"DateTime"==a.dataType?r[n]=new Date(s):r[n]=f.cleanColHtml&&"string"==a.listDataType?s.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):s}):Object.keys(o).forEach(function(e){var t=o[e];r[e]=t}),r.__metadata&&!l.metadata&&delete r.__metadata,e.d.__next){var i={prevId:"",maxItems:""};e.d.__next.split("&").forEach(function(e,t){-1<e.indexOf("p_ID%3d")?i.prevId=e.split("&")[0].split("%3d")[2]:-1<e.indexOf("%24top=")&&(i.maxItems=e.substring(e.lastIndexOf("=")+1))}),i.prevId&&i.maxItems&&(r.__next=i)}l.spArrData.push(r)});else if((e&&e.d?e.d:e||0)&&"object"==typeof(e.d||e)&&0<Object.keys(e.d||e).length){var r={},i=e.d||e;Object.keys(i).forEach(function(e){var t=i[e];r[e]=t}),r.__metadata&&!l.metadata&&delete r.__metadata,l.spArrData.push(r)}n(l.spArrData)}).catch(function(e){(!NODEJS||f.nodeEnabled)&&"string"==typeof e&&-1<e.indexOf("(403)")&&d<=f.maxRetries?Promise.resolve().then(function(){return sprLib.renewSecurityToken()}).then(function(){var e=document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null;u&&console.log("err-403: token renewed"),l.headers&&l.headers["X-RequestDigest"]&&(l.headers["X-RequestDigest"]=e),d++,sprLib.rest(l)}):(d=0,t(e))})})},sprLib.site=function(s){var e={},o=s?(s+"/").replace(/\/+$/g,"/"):"";return e.info=function(){return new Promise(function(r,t){Promise.all([sprLib.rest({url:o+"_api/web",queryCols:["Id","Title","Description","Language","Created","LastItemModifiedDate","LastItemUserModifiedDate","RequestAccessEmail","SiteLogoUrl","Url","WebTemplate","AssociatedOwnerGroup/Id","AssociatedMemberGroup/Id","AssociatedVisitorGroup/Id","AssociatedOwnerGroup/OwnerTitle","AssociatedMemberGroup/OwnerTitle","AssociatedVisitorGroup/OwnerTitle","AssociatedOwnerGroup/Title","AssociatedMemberGroup/Title","AssociatedVisitorGroup/Title"],cache:!1}),sprLib.rest({url:o+"_api/site",queryCols:["Owner/Email","Owner/LoginName","Owner/Title","Owner/IsSiteAdmin"],cache:!1})]).then(function(e){var t=e[0][0];t.Owner=e[1][0].Owner,delete t.Owner.__metadata,delete t.AssociatedMemberGroup.__metadata,delete t.AssociatedOwnerGroup.__metadata,delete t.AssociatedVisitorGroup.__metadata,t.hasOwnProperty("LastItemUserModifiedDate")&&!t.LastItemUserModifiedDate&&delete t.LastItemUserModifiedDate,r(t)}).catch(function(e){t(e)})})},e.lists=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/lists",queryCols:["Id","Title","Description","ItemCount","BaseType","BaseTemplate","Hidden","ImageUrl","ParentWebUrl","RootFolder/ServerRelativeUrl"]}).then(function(e){e.forEach(function(e,t){e.ServerRelativeUrl=e.RootFolder&&e.RootFolder.ServerRelativeUrl?e.RootFolder.ServerRelativeUrl:null,e.RootFolder&&delete e.RootFolder,e.BaseType=i[e.BaseType]||e.BaseType}),t(e||[])}).catch(function(e){r(e)})})},e.subsites=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/webs",queryCols:{Id:{dataName:"Id",dispName:"Id"},Name:{dataName:"Title",dispName:"Subsite Name"},UrlAbs:{dataName:"Url",dispName:"Absolute URL"},UrlRel:{dataName:"ServerRelativeUrl",dispName:"Relative URL"},Created:{dataName:"Created",dispName:"Date Created"},Modified:{dataName:"LastItemModifiedDate",dispName:"Date Last Modified"},Language:{dataName:"Language",dispName:"Language"},SiteLogoUrl:{dataName:"SiteLogoUrl",dispName:"Site Logo URL"}}}).then(function(e){t(e||[])}).catch(function(e){r(e)})})},e.perms=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/roleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=c[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},e.roles=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/roleDefinitions",queryCols:["Id","Name","Description","RoleTypeKind","Hidden"]}).then(function(e){t(e||[])}).catch(function(e){r(e)})})},e.groups=function(n){return new Promise(function(t,r){var i=[];if(n&&0<Object.keys(n).length&&!n.hasOwnProperty("id")&&!n.hasOwnProperty("title")&&(console.warn("Warning..: Check your options! Available `site().groups()` options are: `id`,`title`"),console.warn("Result...: Invalid filter option: All site groups will be returned"),n=null),s){var e="Member/PrincipalType eq 8";n&&n.id?e="Member/Id eq "+n.id:n&&n.title&&(e="Member/Title eq '"+n.title+"'"),sprLib.rest({url:o+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Description","Member/OwnerTitle","Member/PrincipalType","Member/AllowMembersEditMembership","Member/Users/Id","Member/Users/LoginName","Member/Users/Title"],queryFilter:e,queryLimit:f.maxRows}).then(function(e){e.forEach(function(e,t){i.push({Id:e.Member.Id,Title:e.Member.Title,Description:e.Member.Description,OwnerTitle:e.Member.OwnerTitle,PrincipalType:c[e.Member.PrincipalType]||e.Member.PrincipalType,AllowMembersEditMembership:e.Member.AllowMembersEditMembership,Users:e.Member.Users.map(function(e){return e.__metadata&&delete e.__metadata,e})})}),t(i||[])}).catch(function(e){r(e)})}else{e="";n&&n.id?e="Id eq "+n.id:n&&n.title&&(e="Title eq '"+n.title+"'"),sprLib.rest({url:o+"_api/web/SiteGroups",queryCols:["Id","Title","Description","OwnerTitle","PrincipalType","AllowMembersEditMembership","Users/Id","Users/LoginName","Users/Title"],queryFilter:e,queryLimit:f.maxRows}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("SharingLinks")})),e.forEach(function(e,t){e.PrincipalType=c[e.PrincipalType]||e.PrincipalType}),t(e||[])}).catch(function(e){r(e)})}})},e.users=function(a){return new Promise(function(n,t){a&&0<Object.keys(a).length&&!a.hasOwnProperty("id")&&!a.hasOwnProperty("title")&&(console.warn("Warning..: Check your options! Available `site().users()` options are: `id`,`title`"),console.warn("Result...: Invalid filter option: All site users will be returned"),a=null),s?Promise.all([sprLib.rest({url:o+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Email","Member/LoginName","Member/Title","Member/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 1",queryLimit:f.maxRows}),sprLib.rest({url:o+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Users/Id","Member/Users/Email","Member/Users/LoginName","Member/Users/Title","Member/Users/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 8",queryLimit:f.maxRows})]).then(function(e){var r=[],i={};e[0].forEach(function(e){e.Member.Groups=[],(!a||a&&a.id&&a.id==e.Member.Id||a&&a.title&&a.title==e.Member.Title)&&(r.push(e.Member),i[e.Member.Id]=e.Member)}),e[1].forEach(function(t){t.Member.Users&&0<t.Member.Users.length&&t.Member.Users.forEach(function(e){e.__metadata&&delete e.__metadata,(!a||a&&a.id&&a.id==e.Id||a&&a.title&&a.title==e.Title)&&(e.Groups||(e.Groups=[]),e.Groups.push({Id:t.Member.Id,Title:t.Member.Title}),i[e.Id]?(i[e.Id].Groups||(i[e.Id].Groups=[]),i[e.Id].Groups.push({Id:t.Member.Id,Title:t.Member.Title})):(r.push(e),i[e.Id]=t.Member))})}),n(r||[])}).catch(function(e){t(e)}):sprLib.rest({url:o+"_api/web/SiteUsers",queryCols:["Id","Email","LoginName","Title","IsSiteAdmin","Groups/Id","Groups/Title"],queryFilter:"PrincipalType eq 1",queryLimit:f.maxRows}).then(function(e){var t=[];e.forEach(function(e){(!a||a&&a.id&&a.id==e.Id||a&&a.title&&a.title==e.Title)&&-1==e.Title.indexOf("spocrwl")&&e.Id<1e9&&t.push(e)}),n(t||[])}).catch(function(e){t(e)})})},e},sprLib.user=function(a){var e={},t="_api/Web",i="/CurrentUser?";return!(a&&0<Object.keys(a).length)||a.hasOwnProperty("id")||a.hasOwnProperty("email")||a.hasOwnProperty("login")||a.hasOwnProperty("title")||(console.warn("Warning: Check your options! Available `user()` options are: `id`,`email`,`login`,`title`"),console.warn("Result: Current user is being returned"),a={}),(a=a||{}).hasOwnProperty("baseUrl")&&(t=a.baseUrl.toString().replace(/\/+$/,"")+"/_api/Web"),a&&a.id?i="/siteusers?$filter=Id%20eq%20"+a.id+"&":a&&a.email?i="/siteusers?$filter=Email%20eq%20%27"+a.email+"%27&":a&&a.login?i="/siteusers?$filter=LoginName%20eq%20%27"+a.login.replace(/#/g,"%23")+"%27&":a&&a.title&&(i="/siteusers?$filter=Title%20eq%20%27"+a.title+"%27&"),i=t+i,e.info=function(){return new Promise(function(e,t){sprLib.rest({url:i+"$select=Id,Title,Email,LoginName,IsSiteAdmin,PrincipalType",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(r){var i={};(r&&Array.isArray(r)&&r[0]&&0<Object.keys(r[0]).length?Object.keys(r[0]):[]).forEach(function(e,t){i[e]=r[0][e]}),e(i)}).catch(function(e){t(e)})})},e.groups=function(){return new Promise(function(t,r){sprLib.rest({url:i+"$select=Groups/Id,Groups/Title,Groups/Description,Groups/LoginName,Groups/OwnerTitle&$expand=Groups",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(e){var r=[];(e&&e[0]&&e[0].Groups&&e[0].Groups.results?e[0].Groups.results:[]).forEach(function(e,t){r.push({Id:e.Id,Title:e.Title,Description:e.Description,OwnerTitle:e.OwnerTitle,LoginName:e.LoginName})}),t(r)}).catch(function(e){r(e)})})},e.profile=function(i){return new Promise(function(e,t){var n=Array.isArray(i)?i:"string"==typeof i?[i]:null,r=a&&a.login?encodeURIComponent(a.login):null;Promise.resolve().then(function(){if(a&&!a.login)return sprLib.user(a).info()}).then(function(e){return e&&(r=encodeURIComponent(e.LoginName)),r?sprLib.rest({url:"_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='"+r+"'",type:"POST",metadata:!1}):sprLib.rest({url:"_api/SP.UserProfiles.PeopleManager/GetMyProperties",metadata:!1})}).then(function(t){var r={};if(t&&t[0]&&t[0].hasOwnProperty("GetPropertiesFor")&&e({}),t[0]&&Array.isArray(n)&&0<n.length?n.forEach(function(e){r[e]=t[0][e]||"ERROR: No such property exists in SP.UserProfiles.PeopleManager"}):t[0]?r=t[0]:u&&console.log("??? `arrProfileProps[0]` does not exist!"),Object.keys(r).forEach(function(e){r[e]&&r[e].__metadata&&delete r[e].__metadata,r[e]&&r[e].ValueType&&delete r[e].ValueType,"UserProfileProperties"==e&&(r[e]=r[e].results),r[e]&&r[e].results&&(r[e]=r[e].results)}),r.UserProfileProperties){var i={};r.UserProfileProperties.forEach(function(e){i[e.Key]=e.Value}),r.UserProfileProperties=i}e(0==Object.keys(r).length?{}:r)}).catch(function(e){t(e)})})},e},sprLib.renewSecurityToken=function(){return new Promise(function(r,t){sprLib.rest({url:"_api/contextinfo",type:"POST"}).then(function(e){var t=e&&e[0]&&e[0].GetContextWebInformation&&e[0].GetContextWebInformation.FormDigestValue?e[0].GetContextWebInformation.FormDigestValue:null;"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&(document.getElementById("__REQUESTDIGEST").value=t),r(t)}).catch(function(e){t(e)})})},sprLib.nodeConfig=function(e){e=e&&"object"==typeof e?e:{},f.nodeCookie=e.cookie||"",f.nodeEnabled=void 0===e.nodeEnabled||e.nodeEnabled,f.nodeServer=e.server||""}}(),NODEJS||"undefined"==typeof window||!window.NodeList||NodeList.prototype.forEach||(NodeList.prototype.forEach=function(e,t){t=t||window;for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),NODEJS){var https=require("https");module.exports=sprLib}
//# sourceMappingURL=sprestlib.bundle.js.map
